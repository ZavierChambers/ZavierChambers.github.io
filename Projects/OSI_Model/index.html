<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OSI Layers — Tap to Explore</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --muted:#94a3b8; --text:#e2e8f0; --accent:#7c3aed;
      --l7:#7c3aed; --l6:#0891b2; --l5:#06b6d4; --l4:#22c55e; --l3:#a3e635; --l2:#f59e0b; --l1:#f43f5e;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial; color:var(--text); background:var(--bg); overflow:hidden}

    header{height:56px; display:flex; align-items:center; justify-content:center; gap:10px; padding:0 16px; border-bottom:1px solid rgba(124,58,237,.25); background:linear-gradient(180deg, #0f172a , rgba(11,18,32,.75));}
    header h1{margin:0; font-size:16px; letter-spacing:.3px}
    header .muted{color:var(--muted)}

    main{height:calc(100% - 56px - 96px); padding:12px; display:grid; place-items:center}
    .stage{position:relative; height:100%; width:min(1200px, 96vw); border:1px solid rgba(124,58,237,.25); border-radius:var(--radius); background:linear-gradient(180deg,#0f172a,#0b1220); box-shadow:var(--shadow); padding:14px; display:flex; flex-direction:column; gap:10px}

    .lane{flex:1; display:grid; grid-template-columns:220px 1fr; align-items:center; gap:14px; border-radius:12px; padding:8px 10px; cursor:pointer; position:relative; transition:background .2s ease}
    .lane::after{content:""; position:absolute; left:230px; right:12px; top:50%; border-top:2px dashed rgba(148,163,184,.28); pointer-events:none}
    .lane:hover{background:linear-gradient(90deg, rgba(124,58,237,.06), transparent 55%)}
    .label{display:flex; align-items:center; gap:10px; background:#0b1220; border:1px solid rgba(148,163,184,.25); border-radius:10px; padding:8px 10px; font-weight:700}
    .label small{color:var(--muted); font-weight:600}
    .l7{--c:var(--l7)} .l6{--c:var(--l6)} .l5{--c:var(--l5)} .l4{--c:var(--l4)} .l3{--c:var(--l3)} .l2{--c:var(--l2)} .l1{--c:var(--l1)}
    .label i{width:10px; height:10px; border-radius:3px; background:var(--c); box-shadow:0 0 16px color-mix(in oklab, var(--c) 60%, transparent)}
    .lane:hover .label{box-shadow:0 0 0 1px color-mix(in oklab, var(--c) 55%, transparent), 0 0 28px color-mix(in oklab, var(--c) 30%, transparent)}

    /* Packet token + floating info bubble */
    .packet{
      position:absolute; left:260px; top:0;               /* ⬅️ moved from 20px to 0 */
      transform:translateY(0);
      transition:transform 480ms cubic-bezier(.22,1,.36,1);
      display:flex; align-items:center; gap:10px;
      will-change: transform;
    }
    .packet.snap{animation: snap-in 260ms ease-out}
    @keyframes snap-in{
      0%{ transform: translateY(var(--y,0px)) }
      65%{ transform: translateY(calc(var(--y,0px) + 6px)) }
      100%{ transform: translateY(var(--y,0px)) }
    }

    .chip{display:flex; align-items:center; gap:8px; background:linear-gradient(180deg,#111827,#0b1220); border:1px solid rgba(148,163,184,.4); border-radius:12px; padding:8px 12px; box-shadow:0 8px 16px rgba(0,0,0,.35); white-space:nowrap}
    .chip .dot{width:10px; height:10px; border-radius:3px; background:var(--c)}
    .chip .title{font-weight:800; letter-spacing:.2px}

    .bubble{min-width:280px; max-width:520px; background:linear-gradient(180deg,#0e1628,#0b1220); border:1px solid rgba(148,163,184,.35); border-radius:12px; padding:10px 12px; box-shadow:0 10px 28px rgba(0,0,0,.4); transform:translateY(0); opacity:.98}
    .bubble h4{margin:0 0 6px; font-size:14px}
    .bubble .row{display:flex; gap:10px; flex-wrap:wrap; margin:6px 0}
    .tag{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; border:1px solid rgba(148,163,184,.28); border-radius:8px; padding:3px 6px; background:#0b1220}
    .dim{opacity:.45}
    .diagram{display:flex; gap:6px; flex-wrap:wrap; margin-top:6px}
    .hdr{padding:4px 8px; border-radius:8px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; border:1px solid rgba(148,163,184,.3); background:#0f172a}
    .hdr[data-layer="L2"]{border-color:color-mix(in oklab, var(--l2) 70%, rgba(148,163,184,.3));}
    .hdr[data-layer="L3"]{border-color:color-mix(in oklab, var(--l3) 70%, rgba(148,163,184,.3));}
    .hdr[data-layer="L4"]{border-color:color-mix(in oklab, var(--l4) 70%, rgba(148,163,184,.3));}
    .hdr[data-layer="L7"]{border-color:color-mix(in oklab, var(--l7) 70%, rgba(148,163,184,.3));}
    .trail{opacity:.9; border-style:dashed}
    .pdu{font-weight:700; padding:2px 6px; border-radius:7px; background:#0b1220; border:1px solid rgba(148,163,184,.25)}
    .bubble .muted{color:var(--muted)}

    footer{height:96px; border-top:1px solid rgba(124,58,237,.25); display:flex; align-items:center; justify-content:center; padding:10px 14px; background:linear-gradient(180deg, rgba(11,18,32,.75), #0b1220)}
    .explain{max-width:1200px; width:96vw; background:#0f172a; border:1px solid rgba(124,58,237,.25); border-radius:12px; padding:10px 12px; font-size:14px}
    .muted{color:var(--muted)}

    @media (max-width: 1000px){
      .lane{grid-template-columns:170px 1fr}
      .lane::after{left:180px}
      .packet{left:210px}
      .bubble{max-width:58vw}
    }
    @media (max-width: 640px){
      .packet{left:12px}
      .bubble{display:none} /* keep simple on tiny screens */
    }
  </style>
</head>
<body>
  <header>
    <h1>OSI Layers</h1>
    <div class="muted">Click a row to move the packet. The bubble shows what’s visible here and what gets stripped off above.</div>
  </header>

  <main>
    <section class="stage" id="stage">
      <div class="lane l7" data-idx="0"><div class="label"><i></i> Application <small>(your data)</small></div></div>
      <div class="lane l6" data-idx="1"><div class="label"><i></i> Presentation <small>(format &amp; encoding)</small></div></div>
      <div class="lane l5" data-idx="2"><div class="label"><i></i> Session <small>(conversations)</small></div></div>
      <div class="lane l4" data-idx="3"><div class="label"><i></i> Transport <small>(ports &amp; reliability)</small></div></div>
      <div class="lane l3" data-idx="4"><div class="label"><i></i> Network <small>(IP &amp; routing)</small></div></div>
      <div class="lane l2" data-idx="5"><div class="label"><i></i> Data Link <small>(MACs &amp; frames)</small></div></div>
      <div class="lane l1" data-idx="6"><div class="label"><i></i> Physical <small>(bits on wire/air)</small></div></div>

      <!-- Moving token + floating bubble -->
      <div id="packet" class="packet">
        <div class="chip" id="chip" style="--c:var(--l7)"><span class="dot"></span><span class="title" id="chipTitle">L7 · Application Data</span></div>
        <div class="bubble" id="bubble"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="explain" id="explain">Ready. Click any layer above. The packet’s info bubble follows the chip and updates with example headers/fields. Tip: start at Data Link (L2) to see MAC addressing, then go up to watch fields get “stripped off.”</div>
  </footer>

  <script>
    ;(() => {
      const lanes = Array.from(document.querySelectorAll('.lane'))
      const packet = document.getElementById('packet')
      const chip = document.getElementById('chip')
      const chipTitle = document.getElementById('chipTitle')
      const bubble = document.getElementById('bubble')
      const explain = document.getElementById('explain')

      const sample = {
        srcMAC: '9C:5C:8E:12:34:56',
        dstMAC: '3A:52:78:AB:CD:EF',
        etherType: '0x0800 (IPv4)',
        fcs: '0x6A4C2E97',
        srcIP: '10.0.0.5',
        dstIP: '93.184.216.34',
        ttl: 64,
        proto: 'TCP (6)',
        srcPort: 51514,
        dstPort: 80,
        seq: 456001,
        ack: 789200,
        flags: 'PSH, ACK',
        appPreview: 'GET / HTTP/1.1\\r\\nHost: example.com\\r\\n\\r\\n'
      }

      const layers = [
        { name:'Application', num:7, color:'var(--l7)', pdu:'Data',
          explain:'Your actual content (e.g., HTTP message body or request line). At this point, all lower-layer headers have been stripped off.' },
        { name:'Presentation', num:6, color:'var(--l6)', pdu:'Data',
          explain:'Transforms like character encoding or compression. (No extra network headers here in this simple demo.)' },
        { name:'Session', num:5, color:'var(--l5)', pdu:'Data',
          explain:'Tracks conversations/checkpoints (abstract in most modern stacks).' },
        { name:'Transport', num:4, color:'var(--l4)', pdu:'Segment',
          explain:'Ports, sequencing, reliability. TCP or UDP lives here.' },
        { name:'Network', num:3, color:'var(--l3)', pdu:'Packet',
          explain:'IP addressing and routing. Routers read/update IP header (e.g., TTL).' },
        { name:'Data Link', num:2, color:'var(--l2)', pdu:'Frame',
          explain:'Local delivery on the link. Switches forward by MAC. FCS checks errors.' },
        { name:'Physical', num:1, color:'var(--l1)', pdu:'Bits',
          explain:'Signals on copper/fiber/radio. Just 1s and 0s on the medium.' },
      ]

      function buildDiagram(idx){
        const stack = [
          { label:`L2 Ethernet`, layer:'L2', fields:`dst=${sample.dstMAC} · src=${sample.srcMAC} · type=${sample.etherType}`, trailer:`FCS=${sample.fcs}` },
          { label:`L3 IPv4`, layer:'L3', fields:`src=${sample.srcIP} · dst=${sample.dstIP} · TTL=${sample.ttl} · proto=${sample.proto}` },
          { label:`L4 TCP`, layer:'L4', fields:`${sample.srcPort}→${sample.dstPort} · seq=${sample.seq} · ack=${sample.ack} · flags=${sample.flags}` },
          { label:`L7 Data`, layer:'L7', fields:`${sample.appPreview}` },
        ]
        const visible = (i => {
          if(i >= 5) return [0,1,2,3]
          if(i === 4) return [1,2,3]
          if(i === 3) return [2,3]
          return [3]
        })(idx)

        const dimL2  = idx < 5
        const dimL3  = idx < 4
        const dimL4  = idx < 3

        return `
          <div class="diagram">
            <span class="hdr ${dimL2?'dim':''}" data-layer="L2">[Ethernet hdr ${dimL2?'(stripped ↑)':''}]</span>
            <span class="hdr ${dimL3?'dim':''}" data-layer="L3">[IPv4 hdr ${dimL3?'(stripped ↑)':''}]</span>
            <span class="hdr ${dimL4?'dim':''}" data-layer="L4">[TCP hdr ${dimL4?'(stripped ↑)':''}]</span>
            <span class="hdr" data-layer="L7">[App data]</span>
            <span class="hdr trail ${dimL2?'dim':''}" data-layer="L2">[FCS]</span>
          </div>
          <div class="row">
            ${visible.includes(0)? `<span class="tag">L2 dst: ${sample.dstMAC}</span><span class="tag">L2 src: ${sample.srcMAC}</span><span class="tag">EtherType: ${sample.etherType}</span><span class="tag">FCS: ${sample.fcs}</span>` : ''}
            ${visible.includes(1)? `<span class="tag">IP src: ${sample.srcIP}</span><span class="tag">IP dst: ${sample.dstIP}</span><span class="tag">TTL: ${sample.ttl}</span><span class="tag">Proto: ${sample.proto}</span>` : ''}
            ${visible.includes(2)? `<span class="tag">TCP ${sample.srcPort}→${sample.dstPort}</span><span class="tag">SEQ ${sample.seq}</span><span class="tag">ACK ${sample.ack}</span><span class="tag">Flags ${sample.flags}</span>` : ''}
            ${visible.includes(3)? `<span class="tag">Preview: ${sample.appPreview.replaceAll('<','&lt;')}</span>` : ''}
          </div>
          <div class="muted">PDU here: <span class="pdu">${layers[idx].pdu}</span></div>
        `
      }

      function laneY(idx){
        const firstTop = lanes[0].offsetTop
        const laneCenter = (lanes[idx].offsetTop - firstTop) + (lanes[idx].offsetHeight / 2)
        const halfPacket = packet.offsetHeight / 2               // ⬅️ use full packet+bubble height
        return laneCenter - halfPacket
      }

      function setLayer(idx){
        const layer = layers[idx]

        // Update color/title first
        chip.style.setProperty('--c', layer.color)
        chipTitle.textContent = `L${layer.num} · ${layer.name}${idx===6?' (Bits)':''}`

        // Build bubble BEFORE measuring y (so height is correct)
        bubble.innerHTML = `
          <h4 style="color:${layer.color}">L${layer.num} — ${layer.name}</h4>
          <div class="muted" style="margin-bottom:6px">${layer.explain}</div>
          ${buildDiagram(idx)}
        `

        // Compute Y with the now-correct height
        const y = laneY(idx)
        packet.style.setProperty('--y', y+'px')
        packet.style.transform = `translateY(${y}px)`

        // Snap animation (restarts each move)
        packet.classList.remove('snap')
        // next frame to retrigger animation
        requestAnimationFrame(()=> packet.classList.add('snap'))

        // Footer hint
        explain.innerHTML = [
          `<b>${layer.name} (L${layer.num})</b>: `,
          (idx===5? 'Switches use the <b>dst MAC</b> to forward the frame on the LAN. FCS verifies integrity.' :
           idx===4? 'Routers read the <b>dst IP</b>, decrement <b>TTL</b>, and forward to next hop.' :
           idx===3? 'TCP ports identify the app endpoints; SEQ/ACK keep order and reliability.' :
           idx<=2? 'Upper layers work with just the data; lower headers are already removed.' :
           'Electrical/optical/radio signals carry the bits.')
        ].join('')
        current = idx
      }

      let current = 0
      lanes.forEach((lane,i)=> lane.addEventListener('click', ()=> setLayer(i)) )
      window.addEventListener('resize', ()=> setLayer(current))
      setLayer(0)
    })()
  </script>
</body>
</html>
